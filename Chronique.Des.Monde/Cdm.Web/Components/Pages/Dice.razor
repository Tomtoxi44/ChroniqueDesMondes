@page "/dice"
@using Cdm.Web.Components.Shared

<PageTitle>Lanceur de Dés - Chronique des Mondes</PageTitle>

<RequireAuth RequireAuthentication="true">
    <div class="dice-container animate-fade-in">
        <div class="page-header">
            <h1>Lanceur de Dés</h1>
            <p>Testez votre chance avec les dés magiques</p>
        </div>

        <div class="dice-section">
            <div class="dice-controls card">
                <h3>Configuration du Lancer</h3>
                
                <div class="dice-row">
                    <div class="dice-input-group">
                        <label for="diceCount">Nombre de dés</label>
                        <input type="number" id="diceCount" @bind="diceCount" min="1" max="20" class="form-control" />
                    </div>
                    
                    <div class="dice-input-group">
                        <label for="diceType">Type de dé</label>
                        <select id="diceType" @bind="selectedDiceType" class="form-control">
                            @foreach (var dice in diceTypes)
                            {
                                <option value="@dice.Value">@dice.Text</option>
                            }
                        </select>
                    </div>
                    
                    <div class="dice-input-group">
                        <label for="modifier">Modificateur</label>
                        <input type="number" id="modifier" @bind="modifier" min="-20" max="20" class="form-control" />
                    </div>
                </div>

                <div class="dice-actions">
                    <button class="btn btn-primary btn-lg" @onclick="RollDice" disabled="@isRolling">
                        @if (isRolling)
                        {
                            <span class="spinner"></span>
                            <span>Lancement...</span>
                        }
                        else
                        {
                            <span class="dice-icon">🎲</span>
                            <span>Lancer les dés</span>
                        }
                    </button>
                    
                    <button class="btn btn-secondary" @onclick="ClearHistory">
                        Effacer l'historique
                    </button>
                </div>
            </div>

            <div class="dice-result card">
                @if (lastResult != null)
                {
                    <div class="result-display animate-fade-in">
                        <div class="result-total @GetResultClass(lastResult.Total)">
                            @lastResult.Total
                        </div>
                        <div class="result-details">
                            <div class="result-formula">
                                @lastResult.Formula
                            </div>
                            <div class="result-breakdown">
                                Dés: [@string.Join(", ", lastResult.DiceResults)]
                                @if (lastResult.Modifier != 0)
                                {
                                    <span> + Modificateur: @lastResult.Modifier</span>
                                }
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="result-placeholder">
                        <div class="placeholder-icon">🎲</div>
                        <p>Cliquez sur "Lancer les dés" pour commencer</p>
                    </div>
                }
            </div>
        </div>

        <div class="dice-history card">
            <h3>Historique des Lancers</h3>
            @if (rollHistory.Any())
            {
                <div class="history-list">
                    @foreach (var result in rollHistory.Take(10))
                    {
                        <div class="history-item animate-slide-left">
                            <div class="history-formula">@result.Formula</div>
                            <div class="history-result @GetResultClass(result.Total)">@result.Total</div>
                            <div class="history-time">@result.Timestamp.ToString("HH:mm:ss")</div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="history-empty">
                    <p>Aucun lancer enregistré</p>
                </div>
            }
        </div>
    </div>
</RequireAuth>